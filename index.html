<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Setlist Streamer</title>
<link rel="manifest" href="manifest.json?v=3"/>
<meta name="theme-color" content="#0f0f10"/>
<link rel="icon" href="icons/logo-32.png?v=3" sizes="32x32" type="image/png"/>
<link rel="apple-touch-icon" href="icons/logo-192.png?v=3"/>
<style>
  :root{
    --bg:#0f0f10; --fg:#f3f3f4; --muted:#9aa0a6; --card:#17181a; --ink:#cfcfd2;
    --accent:#5dd6ff; --warn:#ffd54a; --ok:#60d394; --border:#232427;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
  a{color:inherit;text-decoration:none}
  button{font:inherit}

  /* Header */
  header{position:sticky;top:0;z-index:50;background:linear-gradient(#121315,#0f0f10);border-bottom:1px solid var(--border)}
  .topbar{display:flex;align-items:center;justify-content:space-between;padding:10px 12px}
  .titleWrap{display:flex;flex-direction:column;gap:2px}
  .appTitle{font-weight:700;letter-spacing:.2px}
  .subtitle{font-size:13px;color:var(--muted)}
  .hdrBtns{display:flex;gap:8px}
  .iconBtn{min-width:38px;min-height:38px;border-radius:12px;border:1px solid var(--border);background:#141518;display:grid;place-items:center}
  .iconBtn:active{transform:translateY(1px)}

  /* Slide-out menu */
  #menuOverlay{position:fixed;inset:0;background:#0009;backdrop-filter:blur(2px);display:none;z-index:60}
  #menu{position:fixed;left:0;top:0;bottom:0;width:300px;max-width:85vw;background:#121316;border-right:1px solid var(--border);transform:translateX(-100%);transition:transform .2s ease;z-index:70;display:flex;flex-direction:column}
  #menu.open{transform:translateX(0)}
  #menuHeader{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
  #menu ul{list-style:none;margin:0;padding:6px}
  #menu li{margin:2px 0}
  #menu a{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;color:var(--ink)}
  #menu a:hover{background:#1a1c20;color:var(--fg)}
  .sub{padding-left:26px}

  /* Pages */
  main{padding:10px 12px 80px}
  .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:10px}
  .bandName,.concertName{font-weight:600}

  /* Filters row */
  .filters{display:flex;align-items:center;gap:8px;margin:6px 0 12px}
  .pill{padding:8px 10px;border:1px solid var(--border);border-radius:999px;color:var(--ink);background:#141518}
  .pill:active{transform:translateY(1px)}

  /* Favorites button state (REQUEST #3/#4) */
  .favToggle{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--border);border-radius:12px;background:#141518;color:var(--ink)}
  .favToggle .star{font-size:16px;line-height:1; display:inline-block}
  .favToggle.is-on{color:var(--warn);border-color:#3a3314;box-shadow:0 0 0 1px #2b2410 inset}
  .favToggle.is-on .star{filter:drop-shadow(0 0 2px #000)}

  /* Lists */
  .list{display:grid;gap:8px}
  .row{display:flex;align-items:center;justify-content:space-between;padding:10px;border:1px solid var(--border);border-radius:12px;background:var(--card)}
  .row .meta{font-size:12px;color:var(--muted)}

  /* Bottom player (compact) */
  #player{position:fixed;left:0;right:0;bottom:0;background:#111214;border-top:1px solid var(--border);display:flex;align-items:center;gap:10px;padding:10px 12px;z-index:55}
  #P_title{flex:1;min-width:0}
  #P_title .t{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--ink)}
  #P_now .eqBars{width:14px;height:14px;display:inline-block;background:conic-gradient(from 0deg,#fff 0 0);mask:url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><g fill=\"%23fff\"><rect x=\"2\" y=\"6\" width=\"4\" height=\"12\"/><rect x=\"10\" y=\"4\" width=\"4\" height=\"16\"/><rect x=\"18\" y=\"8\" width=\"4\" height=\"8\"/></g></svg>') center/contain no-repeat}
  #P_now .eqBars.paused{opacity:.4}

  /* Utility */
  .hide{display:none!important}
  .yellow{color:var(--warn)}

</style>
</head>
<body>
  <div id="menuOverlay"></div>
  <nav id="menu" aria-label="Main">
    <div id="menuHeader">Setlist Streamer</div>
    <ul>
      <li><a href="#bands" data-link="bands">Bands</a></li>
      <li><a href="#concerts" data-link="concerts">Concerts</a></li>
      <li><a href="#tracks" data-link="tracks">Tracks</a></li>
      <li><a href="#fav-bands" data-link="fav-bands" class="sub">Favorites ‚Üí Bands</a></li>
      <li><a href="#fav-concerts" data-link="fav-concerts" class="sub">Favorites ‚Üí Concerts</a></li>
    </ul>
  </nav>

  <header>
    <div class="topbar">
      <button id="btnMenu" class="iconBtn" aria-label="Menu" title="Menu">‚ò∞</button>
      <div class="titleWrap">
        <div class="appTitle" id="hdrLine1">Setlist Streamer ‚Äî Concerts</div>
        <div class="subtitle" id="hdrLine2">Grateful Dead</div>
      </div>
      <div class="hdrBtns">
        <button id="btnFavConcert" class="iconBtn favToggle" title="Favorite Concert"><span class="star">‚òÖ</span><span>Favorite</span></button>
        <button id="btnBack" class="iconBtn" title="Back">‚üµ</button>
      </div>
    </div>
  </header>

  <main>
    <!-- Filters row used on Bands/Concerts pages -->
    <div class="filters" id="filtersRow">
      <button id="btnBandFavFilter" class="pill favToggle" data-scope="bands"><span class="star">‚òÜ</span><span>Favorites</span></button>
      <button id="btnConcertFavFilter" class="pill favToggle" data-scope="concerts"><span class="star">‚òÜ</span><span>Favorites</span></button>
    </div>

    <!-- Pages -->
    <section id="pageBands" class="page">
      <div class="list" id="bandsList"></div>
    </section>

    <section id="pageConcerts" class="page hide">
      <div class="list" id="concertsList"></div>
    </section>

    <section id="pageTracks" class="page hide">
      <div class="list" id="tracksList"></div>
    </section>
  </main>

  <footer id="player">
    <div id="P_now"><span class="eqBars"></span></div>
    <div id="P_title"><div class="t">‚Äî</div></div>
    <button id="P_prev" class="iconBtn" title="Prev">‚èÆ</button>
    <button id="P_play" class="iconBtn" title="Play/Pause">‚èØ</button>
    <button id="P_next" class="iconBtn" title="Next">‚è≠</button>
    <button id="P_vol"  class="iconBtn" title="Volume">üîä</button>
  </footer>

<script>
/* ------------------------
   Minimal data & state
-------------------------*/
const state = {
  page: 'bands',
  currentBand: null,
  currentConcert: null,
  favBands: JSON.parse(localStorage.getItem('favBands')||'[]'),
  favConcerts: JSON.parse(localStorage.getItem('favConcerts')||'[]'),
  filters: { bandsFav:false, concertsFav:false }
};

// Demo data (replace with your API wiring)
const DEMO_BANDS = [
  {id:'gd', name:'Grateful Dead'},
  {id:'sci', name:'String Cheese Incident'},
  {id:'sp', name:'Smashing Pumpkins'},
];
const DEMO_CONCERTS = {
  gd: [
    {id:'gd-1977-05-08', name:'May 8, 1977 ‚Ä¢ Barton Hall, Cornell'},
    {id:'gd-1972-05-26', name:'May 26, 1972 ‚Ä¢ The Strand Lyceum'}
  ],
  sci: [
    {id:'sci-2001-07-13', name:'Jul 13, 2001 ‚Ä¢ Horning Hideout'},
  ],
  sp: [
    {id:'sp-1996-01-08', name:'Jan 8, 1996 ‚Ä¢ Double Door'}
  ]
};

/* ------------------------
   DOM helpers
-------------------------*/
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function setHeader(title1, title2=''){
  $('#hdrLine1').textContent = title1;
  $('#hdrLine2').textContent = title2;
}

function setFavBtnVisual(btn, on){
  btn.classList.toggle('is-on', !!on);
  const star = btn.querySelector('.star');
  if(star) star.textContent = on ? '‚òÖ' : '‚òÜ';
}

function saveFavs(){
  localStorage.setItem('favBands', JSON.stringify(state.favBands));
  localStorage.setItem('favConcerts', JSON.stringify(state.favConcerts));
}

/* ------------------------
   Renderers
-------------------------*/
function renderBands(){
  $('#filtersRow').classList.remove('hide');
  $('#btnBandFavFilter').classList.remove('hide');
  $('#btnConcertFavFilter').classList.add('hide');

  const wrap = $('#bandsList');
  wrap.innerHTML = '';
  let list = DEMO_BANDS;
  if(state.filters.bandsFav) list = list.filter(b=>state.favBands.includes(b.id));

  list.forEach(b=>{
    const row = document.createElement('div');
    row.className = 'row';
    row.innerHTML = `<div><div class="bandName">${b.name}</div><div class="meta">${b.id}</div></div>
      <div>
        <button class="pill" data-act="openBand" data-id="${b.id}">Open</button>
        <button class="pill favToggle" data-act="toggleFavBand" data-id="${b.id}"><span class="star">‚òÜ</span><span>Favorite</span></button>
      </div>`;
    wrap.appendChild(row);

    // set visual state for this row's favorite button
    const btn = row.querySelector('[data-act="toggleFavBand"]');
    setFavBtnVisual(btn, state.favBands.includes(b.id));
  });

  // Header text based on route & filter selection
  if(state.filters.bandsFav){
    setHeader('Setlist Streamer ‚Äî Favorite Bands',''); // REQUEST #1
  } else {
    setHeader('Setlist Streamer ‚Äî Bands','');
  }
}

function renderConcerts(){
  $('#filtersRow').classList.remove('hide');
  $('#btnBandFavFilter').classList.add('hide');
  $('#btnConcertFavFilter').classList.remove('hide');

  const wrap = $('#concertsList');
  wrap.innerHTML = '';
  const listAll = DEMO_CONCERTS[state.currentBand]||[];
  let list = listAll;
  if(state.filters.concertsFav) list = list.filter(c=>state.favConcerts.includes(c.id));

  list.forEach(c=>{
    const row = document.createElement('div');
    row.className = 'row';
    row.innerHTML = `<div><div class="concertName">${c.name}</div><div class="meta">${c.id}</div></div>
      <div>
        <button class="pill" data-act="openConcert" data-id="${c.id}">Open</button>
        <button class="pill favToggle" data-act="toggleFavConcert" data-id="${c.id}"><span class="star">‚òÜ</span><span>Favorite</span></button>
      </div>`;
    wrap.appendChild(row);

    const btn = row.querySelector('[data-act="toggleFavConcert"]');
    setFavBtnVisual(btn, state.favConcerts.includes(c.id));
  });

  // Header text
  if(state.filters.concertsFav){
    setHeader('Setlist Streamer ‚Äî Favorite Concerts', DEMO_BANDS.find(b=>b.id===state.currentBand)?.name||''); // REQUEST #2
  } else {
    setHeader('Setlist Streamer ‚Äî Concerts', DEMO_BANDS.find(b=>b.id===state.currentBand)?.name||'');
  }
}

function renderTracks(){
  $('#filtersRow').classList.add('hide');
  $('#pageTracks .list').innerHTML = '';

  // Header plus top-right Favorite concert button visual (REQUEST #4)
  const isFav = state.currentConcert && state.favConcerts.includes(state.currentConcert);
  setFavBtnVisual($('#btnFavConcert'), isFav); // button in header

  const bandName = DEMO_BANDS.find(b=>b.id===state.currentBand)?.name||'';
  const concertObj = (DEMO_CONCERTS[state.currentBand]||[]).find(c=>c.id===state.currentConcert);
  setHeader('Setlist Streamer ‚Äî Tracks', bandName);

  // Fake tracks
  const wrap = $('#tracksList');
  for(let i=1;i<=10;i++){
    const row = document.createElement('div');
    row.className = 'row';
    row.innerHTML = `<div><div class="trackName">Track ${i}</div><div class="meta">${concertObj?.name||''}</div></div>
      <div><button class="pill">Play</button></div>`;
    wrap.appendChild(row);
  }
}

/* ------------------------
   Routing
-------------------------*/
function showPage(which){
  state.page = which;
  $$('#pageBands, #pageConcerts, #pageTracks').forEach(el=>el.classList.add('hide'));
  if(which==='bands'){
    $('#pageBands').classList.remove('hide');
    renderBands();
  } else if(which==='concerts'){
    $('#pageConcerts').classList.remove('hide');
    renderConcerts();
  } else if(which==='tracks'){
    $('#pageTracks').classList.remove('hide');
    renderTracks();
  }
}

function routeFromHash(){
  const h = location.hash.replace('#','');
  const url = new URL('https://x/'+(h||''));
  const path = (url.pathname||'').replace(/^\//,'');
  const favBands = path==='fav-bands';
  const favConcerts = path==='fav-concerts';

  if(path==='bands' || favBands){
    state.filters.bandsFav = !!favBands;
    showPage('bands');
  } else if(path==='concerts' || favConcerts){
    state.filters.concertsFav = !!favConcerts;
    // keep currentBand; if none, default to first for demo
    if(!state.currentBand) state.currentBand = DEMO_BANDS[0].id;
    showPage('concerts');
  } else if(path==='tracks'){
    showPage('tracks');
  } else {
    // default
    location.hash = 'bands';
  }
}

window.addEventListener('hashchange', routeFromHash);

/* ------------------------
   Global events
-------------------------*/
// Menu
$('#btnMenu').addEventListener('click', ()=>{
  $('#menu').classList.add('open');
  $('#menuOverlay').style.display='block';
});
$('#menuOverlay').addEventListener('click', closeMenu);
function closeMenu(){
  $('#menu').classList.remove('open');
  $('#menuOverlay').style.display='none';
}
$('#menu').addEventListener('click', e=>{
  const a = e.target.closest('a[data-link]');
  if(!a) return;
  closeMenu();
});

// Lists click handling
$('main').addEventListener('click', e=>{
  const btn = e.target.closest('button[data-act]');
  if(!btn) return;
  const id = btn.getAttribute('data-id');
  const act = btn.getAttribute('data-act');

  if(act==='openBand'){
    state.currentBand = id;
    state.filters.concertsFav = false;
    location.hash = 'concerts';
  }
  if(act==='openConcert'){
    state.currentConcert = id;
    location.hash = 'tracks';
  }
  if(act==='toggleFavBand'){
    const i = state.favBands.indexOf(id);
    if(i===-1) state.favBands.push(id); else state.favBands.splice(i,1);
    saveFavs();
    setFavBtnVisual(btn, state.favBands.includes(id));
  }
  if(act==='toggleFavConcert'){
    const i = state.favConcerts.indexOf(id);
    if(i===-1) state.favConcerts.push(id); else state.favConcerts.splice(i,1);
    saveFavs();
    setFavBtnVisual(btn, state.favConcerts.includes(id));
  }
});

// Filters (Favorites toggle pills on Bands/Concerts pages) ‚Äî REQUEST #3
$('#btnBandFavFilter').addEventListener('click', ()=>{
  state.filters.bandsFav = !state.filters.bandsFav;
  setFavBtnVisual($('#btnBandFavFilter'), state.filters.bandsFav);
  // Navigate to explicit route for clarity
  location.hash = state.filters.bandsFav ? 'fav-bands' : 'bands';
});
$('#btnConcertFavFilter').addEventListener('click', ()=>{
  state.filters.concertsFav = !state.filters.concertsFav;
  setFavBtnVisual($('#btnConcertFavFilter'), state.filters.concertsFav);
  location.hash = state.filters.concertsFav ? 'fav-concerts' : 'concerts';
});

// Top-right Favorite button on Tracks page ‚Äî REQUEST #4
$('#btnFavConcert').addEventListener('click', ()=>{
  if(!state.currentConcert) return;
  const id = state.currentConcert;
  const i = state.favConcerts.indexOf(id);
  if(i===-1) state.favConcerts.push(id); else state.favConcerts.splice(i,1);
  saveFavs();
  setFavBtnVisual($('#btnFavConcert'), state.favConcerts.includes(id));
});

// Back button (simple: go to previous logical page)
$('#btnBack').addEventListener('click', ()=>{
  if(state.page==='tracks') location.hash='concerts';
  else if(state.page==='concerts') location.hash='bands';
  else history.back();
});

// Initialize visual states for filter pills
setFavBtnVisual($('#btnBandFavFilter'), state.filters.bandsFav);
setFavBtnVisual($('#btnConcertFavFilter'), state.filters.concertsFav);

// EQ animation state hookup
const A = new Audio();
const EQ = document.querySelector('#P_now .eqBars');
function updateEqAnim(){ if(EQ) EQ.classList.toggle('paused', A.paused); }
A.addEventListener('play',  updateEqAnim);
A.addEventListener('pause', updateEqAnim);
A.addEventListener('ended', updateEqAnim);

// Kick off
document.addEventListener('DOMContentLoaded', routeFromHash);
</script>
</body>
</html>
